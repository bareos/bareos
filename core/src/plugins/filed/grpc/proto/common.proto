syntax = "proto3";

package bareos.common;

import "google/protobuf/timestamp.proto";

enum FileType {
  FILE_TYPE_UNSPECIFIED = 0;
  RegularFile = 1;
  Directory = 2;
  SoftLink = 3;
  SpecialFile = 4;
  BlockDevice = 5;
  Fifo = 6;
  ReparsePoint = 7;
  Junction = 8;
  Deleted = 9;
  HardlinkCopy = 10; // hardlink pointing to file already backed up
  UnchangedFile = 11;
  UnchangedDirectory = 12;
  RestoreObject = 25; // FT_RESTORE_FIRST
};

enum FileErrorType {
  FILE_ERROR_TYPE_UNSPECIFIED = 0;
  InvalidFileSystem = 1;
  InvalidDriveType = 2;
  CouldNotOpenDirectory = 3;
  CouldNotChangeFilesystem = 4;
  RecursionDisabled = 5;
  CouldNotStat = 6;
  CouldNotFollowLink = 7;
  CouldNotAccessFile = 8;
};

enum ObjectType {
  OBJECT_TYPE_UNSPECIFIED = 0;
  Blob = 1;
  Config = 2;
  FilledConfig = 3;
};

message OsStat {
  uint64 dev = 1;
  uint64 ino = 2;
  uint64 mode = 3;
  uint64 nlink = 4;
  uint64 uid = 5;
  uint64 gid = 6;
  uint64 rdev = 7;
  uint64 size = 8;

  google.protobuf.Timestamp atime = 9;
  google.protobuf.Timestamp mtime = 10;
  google.protobuf.Timestamp ctime = 11;

  uint64 blksize = 12;
  uint64 blocks = 13;
}

message PluginObject {
  bytes name = 1;
  bytes data = 2;
  int64 index = 3;
  ObjectType type = 4;
};

message PluginFile {
  bytes file = 1;
  bytes link = 9; // only used when type == LNK
  OsStat stats = 2;
  FileType ft = 3;
  optional int64 delta_seq = 4;


  bool no_read = 5;
  bool portable = 6; // no idea what this means!

  // these flags change how the data is getting backed up
  // but neither of them are supported for now
  bool offset_backup = 7;
  bool sparse_backup = 8;
};

message PluginFileError {
  bytes file = 1;
  FileErrorType error = 2;
};

enum ReplaceType {
  REPLACE_TYPE_UNSPECIFIED = 0;
  ReplaceIfNewer = 1;
  ReplaceIfOlder = 2;
  ReplaceNever = 3;
  ReplaceAlways = 4;
};
