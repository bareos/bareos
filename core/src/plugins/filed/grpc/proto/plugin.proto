syntax = "proto3";

package bareos.plugin;

import "events.proto";

message BeginBackupRequest {
  bytes cmd = 1;
  uint64 max_record_size = 2;
  bytes flags = 3;

  bool backup_acl = 10;
  bool backup_xattr = 11;
  bool portable = 12;
  bool no_atime = 13;
};

message BeginBackupResponse {
};

message BeginRestoreRequest {
};

message BeginRestoreResponse {
};

message BeginEstimateRequest {
};

message BeginEstimateResponse {
};

message BeginVerifyRequest {
};

message BeginVerifyResponse {
};

message SetupRequest {};
message SetupResponse {};

message PluginRequest {
  oneof request {
    SetupRequest setup = 1;
    HandlePluginEventRequest handle_plugin_event = 2;

    BeginBackupRequest begin_backup = 10;
    BeginRestoreRequest begin_restore = 11;
    BeginEstimateRequest begin_estimate = 12;
    BeginVerifyRequest begin_verify = 13;
  };
};

message PluginResponse {
  oneof response {
    SetupResponse setup = 1;
    HandlePluginEventResponse handle_plugin_event = 2;

    BeginBackupResponse begin_backup = 10;
    BeginRestoreResponse begin_restore = 11;
    BeginEstimateResponse begin_estimate = 12;
    BeginVerifyResponse begin_verify = 13;
  };
};

// ---- Handle Plugin Events ----

message HandlePluginEventRequest {
  bareos.plugin.events.Event to_handle = 1;
};

enum ReturnCode {
  RETURN_CODE_UNSPECIFIED = 0;
  RC_OK = 1;     /* OK */
  RC_Stop = 2;   /* Stop calling other plugins */
  RC_Error = 3;  /* Some kind of error */
  RC_More = 4;   /* More files to backup */
  RC_Term = 5;   /* Unload me */
  RC_Seen = 6;   /* Return code from checkFiles */
  RC_Core = 7;   /* Let BAREOS core handles this file */
  RC_Skip = 8;   /* Skip the proposed file */
  RC_Cancel = 9; /* Job cancelled */
};

message HandlePluginEventResponse {
  ReturnCode res = 1;
};
