syntax = "proto3";

package bareos.plugin;

import "events.proto";

message BeginBackupRequest {
  bytes cmd = 1;
  uint64 max_record_size = 2;

  bool backup_acl = 3;
  bool backup_xattr = 4;
};

message BeginBackupResponse {
};

message BeginRestoreRequest {
};

message BeginRestoreResponse {
};

message SetDebugLevel {
  int64 debug_level = 1;
};

message SetupRequest {};
message SetupResponse {};

message PluginRequest {
  oneof request {
    SetupRequest setup = 1;
    BeginBackupRequest begin_backup = 2;
    BeginRestoreRequest begin_restore = 3;
    SetDebugLevel set_debug_level = 4;
    HandlePluginEventRequest handle_plugin_event = 5;
  };
};

message PluginResponse {
  oneof response {
    SetupResponse setup = 1;
    BeginBackupResponse begin_backup = 2;
    BeginRestoreResponse begin_restore = 3;
    HandlePluginEventResponse handle_plugin_event = 5;
  };
};

// ---- Handle Plugin Events ----

message HandlePluginEventRequest {
  bareos.plugin.events.Event to_handle = 1;
};

enum ReturnCode {
  RETURN_CODE_UNSPECIFIED = 0;
  RC_OK = 1;     /* OK */
  RC_Stop = 2;   /* Stop calling other plugins */
  RC_Error = 3;  /* Some kind of error */
  RC_More = 4;   /* More files to backup */
  RC_Term = 5;   /* Unload me */
  RC_Seen = 6;   /* Return code from checkFiles */
  RC_Core = 7;   /* Let BAREOS core handles this file */
  RC_Skip = 8;   /* Skip the proposed file */
  RC_Cancel = 9; /* Job cancelled */
};

message HandlePluginEventResponse {
  ReturnCode res = 1;
};
