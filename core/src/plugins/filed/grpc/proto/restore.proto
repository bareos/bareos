syntax = "proto3";

package bareos.restore;

import "common.proto";

message RestoreRequest {
  oneof request {
    BeginFileRequest begin_file = 1;
    CoreCreationDone core_creation_done = 2;
    FileData file_data = 3;
    bareos.common.Acl acl = 4;
    bareos.common.Xattr xattr = 5;
    Done done = 6;
  };
};

message CoreCreationDone {
  bool success = 1;
};

message RestoreResponse {
  oneof response {
    BeginFileResponse begin_file = 1;
  };
};

message BeginFileRequest {
  bytes output_name = 1;
  bytes soft_link_to = 2; // only if ft == SoftLink
  bareos.common.FileType file_type = 3;
  int64 delta_seq = 4;
  bareos.common.ReplaceType replace = 5;
  optional bytes where = 7; // needed by the vmware plugin
  bareos.common.OsStat stats = 8;
};

enum CreationStatus {
  CREATION_UNSPECIFIED = 0;
  CREATION_SKIP = 1; // skip this file
  // CREATION_ERROR = 2; // file was created, but should not be restored
  CREATION_PLUGIN = 3; // restore this file via the plugin
  CREATION_NODATA = 4; // file was created, but should not be restored
  CREATION_CORE = 5; // restore this file via the core
};

message BeginFileResponse {
  oneof result {
    CreationStatus success = 1;
    int64 system_error = 2;
  };
};

message FileData {
  bytes data = 1;
  uint64 offset = 2;
};

message Done {
};
