#
# This file is used as the template to create the
# Makefile for the Univention specific installation.
# Univention is based on Debian,
# therefore it also calls the Debian Makefile
#
#  for Bareos release @VERSION@ (@DATE@) -- @DISTNAME@
#
@MCOMMON@

install:
	(cd ../debian; $(MAKE) $@;)

	@echo "generating Univention Config Registry (UCR) files ..."
	(cd ../..; ln -s platforms/univention/conffiles conffiles; univention-install-config-registry)

	@$(MKDIR)           $(DESTDIR)/etc/bareos/autogenerated/fd-configs/
	@$(INSTALL_CONFIG)  fd-windows.template $(DESTDIR)/etc/bareos/autogenerated/fd-configs/windows.template
	@$(INSTALL_CONFIG)  fd-generic.template $(DESTDIR)/etc/bareos/autogenerated/fd-configs/generic.template

	@$(MKDIR)           $(DESTDIR)/etc/bareos/autogenerated/fd-secrets/

	@$(MKDIR)           $(DESTDIR)/etc/bareos/autogenerated/clients/
	@$(INSTALL_CONFIG)  job-windows.template $(DESTDIR)/etc/bareos/autogenerated/clients/windows.template
	@$(INSTALL_CONFIG)  job-generic.template $(DESTDIR)/etc/bareos/autogenerated/clients/generic.template

	@$(MKDIR)           $(DESTDIR)/etc/cron.d/
	@$(INSTALL_CONFIG)  univention-bareos.cron $(DESTDIR)/etc/cron.d/univention-bareos

	@$(MKDIR)           $(DESTDIR)/usr/lib/univention-directory-listener/system
	@$(INSTALL_PROGRAM) univention-bareos.py $(DESTDIR)/usr/lib/univention-directory-listener/system

	@$(MKDIR)           $(DESTDIR)/usr/lib/univention-install/
	@$(INSTALL_PROGRAM) 62univention-bareos.inst  $(DESTDIR)/usr/lib/univention-install/

	@$(MKDIR)           $(DESTDIR)/usr/lib/univention-uninstall/
	@$(INSTALL_PROGRAM) 63univention-bareos.uinst $(DESTDIR)/usr/lib/univention-uninstall/

	# dbconfig-common
	@$(MKDIR)           $(DESTDIR)/usr/share/dbconfig-common/data/univention-bareos/install/
	@$(INSTALL_CONFIG)  postgres_create.sql $(DESTDIR)/usr/share/dbconfig-common/data/univention-bareos/install/pgsql

	@$(MKDIR)           $(DESTDIR)/usr/share/univention-bareos/
	@$(INSTALL_PROGRAM) restart_director $(DESTDIR)/usr/share/univention-bareos/

	@$(MKDIR)           $(DESTDIR)/usr/share/univention-ldap/schema/
	@$(INSTALL_CONFIG)  univention-bareos.schema $(DESTDIR)/usr/share/univention-ldap/schema/

clean:
	(cd ../debian; $(MAKE) $@;)
	@$(RMF) 1 2 3

distclean: clean
	(cd ../debian; $(MAKE) $@;)
	@$(RMF) Makefile

devclean: clean
	(cd ../debian; $(MAKE) $@;)
	@$(RMF) Makefile

%:
	(cd ../debian; $(MAKE) $@;)
